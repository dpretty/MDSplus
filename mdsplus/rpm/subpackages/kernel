%package kernel
Summary: MDSplus core system
Group: Applications/Acquisition
Release: --RELEASE--

%description kernel
Core applications, libraries and configuration files

%files kernel
%defattr(-,root,root)
/usr/local/mdsplus/bin*
/usr/local/mdsplus/ChangeLog
/usr/local/mdsplus/etc
/usr/local/mdsplus/include
/usr/local/mdsplus/lib*
/usr/local/mdsplus/man
/usr/local/mdsplus/rpm
/usr/local/mdsplus/setup.csh
/usr/local/mdsplus/setup.sh
/usr/local/mdsplus/tdi
/usr/local/mdsplus/trees

%exclude /usr/local/mdsplus/bin*/dw*
%exclude /usr/local/mdsplus/bin*/act*
%exclude /usr/local/mdsplus/bin*/traverser
%exclude /usr/local/mdsplus/lib*/libXmds*

%exclude /usr/local/mdsplus/bin*/j*
%exclude /usr/local/mdsplus/lib*/libJava*

%exclude /usr/local/mdsplus/bin*/mdsccl
%exclude /usr/local/mdsplus/bin*/mdscts
%exclude /usr/local/mdsplus/lib*/libCam*
%exclude /usr/local/mdsplus/lib*/libcts*
%exclude /usr/local/mdsplus/lib*/libccl*
%exclude /usr/local/mdsplus/lib*/libRemCam*

%exclude /usr/local/mdsplus/lib*/*.a

%exclude /usr/local/mdsplus/lib*/libI*

%exclude /usr/local/mdsplus/lib*/lib*Sql*

%exclude /usr/local/mdsplus/lib*/libMit*
%exclude /usr/local/mdsplus/lib*/libMIT*
%exclude /usr/local/mdsplus/tdi/MitDevices
%exclude /usr/local/mdsplus/bin*/reboot_dtaq_satelite
%exclude /usr/local/mdsplus/tdi/RfxDevices
%exclude /usr/local/mdsplus/tdi/KbsiDevices
%exclude /usr/local/mdsplus/tdi/camac
%exclude /usr/local/mdsplus/tdi/java

%exclude /usr/local/mdsplus/tdi/d3d
%exclude /usr/local/mdsplus/tdi/roam

%post kernel
if [ -d /etc/ld.so.conf.d]
then
  rm -f /etc/ld.so.conf.d/mdsplus.conf 2>/dev/null
  touch /etc/ld.so.conf.d/mdsplus.conf
  for l in lib lib32 lib64
  do
    if [ ! -h $RPM_INSTALL_PREFIX/mdsplus/$l -a -d $RPM_INSTALL_PREFIX/mdsplus/$l ]
    then
      echo "$RPM_INSTALL_PREFIX/mdsplus/lib64" >> /etc/ld.so.conf.d/mdsplus.conf
    fi
  done
  ldconfig > /dev/null 2>&1
fi
echo $RPM_INSTALL_PREFIX/mdsplus > /etc/.mdsplus_dir
if [ -d /etc/profile.d ]
then
  rm -f /etc/profile.d/mdsplus.sh /etc/profile.d/mdsplus.csh 2>/dev/null
  ln -sf $RPM_INSTALL_PREFIX/mdsplus/setup.sh /etc/profile.d/mdsplus.sh
  ln -sf $RPM_INSTALL_PREFIX/mdsplus/setup.csh /etc/profile.d/mdsplus.csh
fi

%postun kernel

rm -f /etc/ld.so.conf.d/mdsplus.conf /etc/profile.d/mdsplus.sh /etc/profile.d/mdsplus.csh /etc/.mdsplus_dir 2>/dev/null
ldconfig >/dev/null 2>&1
